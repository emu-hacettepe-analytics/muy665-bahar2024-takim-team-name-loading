---
title: "KALP HASTALIKLARI TAHM襤NLEME"
number-sections: true
---

**Proje sayfam覺za ho geldiniz, keyifli seyirler dileriz.** 

![](images/13up-healthlife-superJumbo-v2.gif){width="616"}

# Kalp Hastal覺klar覺 Tahminleme Projemizi Tan覺yal覺m

# Veri

Resmi kurumlardan al覺nm覺 Cleveland (330 g繹zlem), Macaristan (294 g繹zlem), 襤svi癟re (123 g繹zlem), Kaliforniya (200 g繹zlem), D羹nya geneli (270 g繹zlem) birletirilerek oluturulmu 918 benzersiz g繹zlem i癟erisinde 11 ba覺ms覺z deiken 羹zerinden kalp hastal覺覺 olup olmad覺覺n覺 g繹stermektedir.

## Veri Kayna覺

Kulland覺覺m覺z veri setleri UCI Makine renimi Havuzundaki kalp hastal覺覺 veri setleri dizini alt覺nda bulunabilir.

Link: <https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/>

## Veri Hakk覺nda Genel Bilgiler

Bu veri setini halihaz覺rda ba覺ms覺z olarak mevcut olan ancak daha 繹nce birletirilmemi farkl覺 veri setlerinin birletirilmesiyle oluturduk. Veri setimizde 5 kalp veri setini 11 ortak 繹zellik 羹zerinden birletirdik. Toplam g繹zlem say覺m覺z tekrarlanan sat覺rlar 癟覺kar覺ld覺覺nda 918 g繹zlemdir.

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"
library(gridExtra)
library(ggplot2)
library(tidyverse)
library(readxl)
library(knitr)
library(kableExtra)
library(lattice)
library(caret)
library(e1071)
library(forecast)
library(pander)
data <- read_excel("heart1.xlsx")
head(data)
```

1.  **Ya ve Cinsiyet**:

    -   Verimizde ya ve cinsiyet fakt繹rleri yer almaktad覺r.

2.  **Ar覺 Tipi**:

    -   ATA (Atipik Angina), NAP (Non-Anginal Pain), ASY (Asemptomatik), TA (Tipik Angina) gibi farkl覺 g繹羹s ar覺s覺 tipleri mevcuttur.

3.  **Dinlenme Kan Bas覺nc覺**:

    -   Hastalar覺n herhangi bir egzersiz yapmad覺覺 s覺radaki kan bas覺n癟lar覺n覺 mm/HG cinsinden g繹stermektedir.

4.  **Kolesterol Seviyeleri**:

    -   Hastalar覺n kolestorel deerlerini g繹stermektedir.

5.  **A癟l覺k Kan ekeri**:

    -   Hastalar覺n a癟l覺k kan ekeri deerlerini g繹ztermektedir.

6.  **Dinlenme EKG Sonu癟lar覺**:

    -   Hastalar覺n dinlenme EKG sonu癟lar覺 normal, ST veya LVH olarak kategorize edilmi.

7.  **Maksimum Kalp At覺 H覺z覺**:

    -   Hastalar覺n egzersiz s覺ras覺ndak maksimum kalp at覺 h覺zlar覺n覺 g繹stermektedir.

8.  **Egzersiz Anginas覺**:

    -   Kalbi besleyen atardamarlar覺n darl覺k, t覺kanma gibi sebeplerle kalbin oksijen ihtiyac覺n覺 kar覺layamad覺覺 durumlarda kalp k繹kenli g繹羹s ar覺s覺 veya s覺k覺nt覺 hissi oluur ve buna t覺p dilinde veya latince angina pektoris ad覺 verilir.

9.  **Oldpeak**:

    -   Dinlenmeye g繹re egzersizin neden olduu ST depresyonu ('ST', EKG grafiindeki konumlarla ilgilidir.

10. **ST Eimi**:

    -   ST eimi, Up (Yukar覺), Flat (D羹z) ve Down (Aa覺) olarak kategorize edilmi.

11. **Kalp Hastal覺覺**:

    -   Kalp hastal覺覺 olan hastalar 1, kalp hastal覺覺 olmayan hastalar 0 ile kategorize edilmitir.

## Tercih Sebebi

Kalp hastal覺klar覺n覺n 繹nceden belirli 繹zelliklere bal覺 olarak tahmin edilip edilemeyecei 羹zerine 癟al覺mak ve toplumdaki genel kan覺 olan, kalp hastal覺klar覺n覺n kal覺tsal olduu inanc覺n覺 irdelemek.

# Analiz

Data analizine str fonksiyonu ile bal覺yoruz.

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"
library(readxl)
data <- read_excel("heart1.xlsx")

str(data)
```

Verinin istatiksel 繹zeti:

NA veri var m覺?

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"

df_total <- read_excel("heart1.xlsx")
sum(is.na(df_total))
# Veri seti 繹zetini pander kullanarak g繹sterme
df_summary <- df_total %>%
  summarise(
    Yas_mean = mean(Yas, na.rm = TRUE),
    Yas_sd = sd(Yas, na.rm = TRUE),
    Dinlenme_Kan_Basinci_mean = mean(`Dinlenme_Kan_Basinci mm/HG`, na.rm = TRUE),
    Dinlenme_Kan_Basinci_sd = sd(`Dinlenme_Kan_Basinci mm/HG`, na.rm = TRUE),
    Kolestorel_mean = mean(Kolestorel, na.rm = TRUE),
    Kolestorel_sd = sd(Kolestorel, na.rm = TRUE),
    Aclik_Kan_Sekeri_mean = mean(Aclik_Kan_Sekeri, na.rm = TRUE),
    Aclik_Kan_Sekeri_sd = sd(Aclik_Kan_Sekeri, na.rm = TRUE),
    Maks_Kalp_Atis_mean = mean(Maks_Kalp_Atis, na.rm = TRUE),
    Maks_Kalp_Atis_sd = sd(Maks_Kalp_Atis, na.rm = TRUE),
    Oldpeak_mean = mean(Oldpeak, na.rm = TRUE),
    Oldpeak_sd = sd(Oldpeak, na.rm = TRUE)
  ) %>%
  gather(key = "Metric", value = "Value")

# Daha g羹zel bir tablo olarak g繹sterme
df_summary %>%
  kable("html", caption = "Veri Seti zet 襤statistikleri") %>%
  kable_styling("striped", full_width = F)

```

Bu 繹zet istatistikler, veri setinin genel sal覺覺n覺 ve pop羹lasyonun sal覺k profillerini anlamak i癟in kritik bilgiler salar. Daha detayl覺 analizler ve grafikler, bu 繹zet istatistiklerin alt覺nda yatan ilikileri ve trendleri ortaya 癟覺karmaya yard覺mc覺 olabilir.

## Keifsel Veri Analizi

Veri setindeki cinsiyet da覺l覺m覺:

Erkekler, t羹m ya aral覺klar覺nda kad覺nlardan daha fazla say覺ya sahip olduu net olarak g繹r羹lmektedir.\
Her iki cinsiyet de 50-55 ya aral覺覺nda zirve yapmaktad覺r. 30-45 ya aral覺覺nda ve 65-75 ya aral覺覺nda erkeklerin say覺s覺 belirgin ekilde daha fazla g繹r羹lmektedir.

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"
df_total <- read_excel("heart1.xlsx")
erkek_sayisi <- sum(df_total$Cinsiyet == "Erkek")
kadin_sayisi <- sum(df_total$Cinsiyet == "Kadin")
cat("Erkek say覺s覺:", erkek_sayisi, "\n")
cat("Kad覺n say覺s覺:", kadin_sayisi, "\n")
barplot(table(df_total$Cinsiyet), main = "Cinsiyet Da覺l覺m覺", xlab = "Cinsiyet", ylab = "Kii Say覺s覺", col = c("blue", "pink"), legend = c("Erkek", "Kad覺n"))

ggplot(df_total, aes(x = Yas, fill = Cinsiyet)) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 10) +
  scale_fill_manual(values = c("blue", "red")) +
  labs(x = "Ya", y = "Frekans", title = "Erkek ve Kad覺nlar覺n Ya Da覺l覺mlar覺") +
  theme_minimal()+
  scale_x_continuous(breaks = seq(30, 70, by = 5))+
  scale_y_continuous(breaks = seq(0, 200, by = 10))
```

Bu veri d羹nya genelinde kalp hastal覺覺 rahats覺zl覺覺 ile hastaneye bavuranlar覺n, b羹y羹k k覺sm覺n覺n erkek olmas覺 sebebiyle erkekler kalp rahats覺zl覺覺na daha yatk覺n olabilir mi? sorusu ortaya atmaktad覺r.

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"
data <- read_excel("heart1.xlsx")
df_summary <- df_total %>%
  group_by(Cinsiyet, Kalp_Hastaligi) %>%
  summarise(count = n()) %>%
  ungroup() %>%
  group_by(Cinsiyet) %>%
  mutate(total = sum(count), proportion = count / total * 100) %>%
  filter(Kalp_Hastaligi == 1)

ggplot(df_summary, aes(x = Cinsiyet, y = proportion, fill = Cinsiyet)) +
  geom_bar(stat = "identity", alpha = 0.7) +
  scale_fill_manual(values = c("Erkek" = "#9999FF", "Kadin" = "#FF9999")) +
  labs(title = "Cinsiyet & Kalp Hastal覺覺na Yakalanma Oran覺(%)", x = "Cinsiyet", y = "Kalp Hastal覺覺na Yakalanma Oran覺(%)") +
  theme_minimal(base_size = 15)+
  theme(
   plot.title = element_text(size = 14),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12)
  ) +
    geom_text(aes(label = paste0(round(proportion, 1), "%")), vjust = -0.5, size = 5)


```

```{r warning = FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"


df_total <- read_excel("heart1.xlsx")
par(mar = c(5, 5, 4, 2) + 0.1)  


df_filtered <- df_total[df_total$Kolestorel > 0,]# Kolesterol deeri s覺f覺r olanlar覺 filtrele

plot(df_filtered$`Dinlenme_Kan_Basinci mm/HG`, df_filtered$Kolestorel, 
     xlab = "Dinlenme Kan Bas覺nc覺 (mm/HG)", 
     ylab = "Kolesterol", 
     main = "Kan Bas覺nc覺 ve Kolesterol 襤likisi", 
     col = ifelse(df_total$Kalp_Hastaligi == 1, "red", "blue"),
     pch = 19,  # Noktalar覺n elki
     cex = 0.5, # Nokta boyutu
     lwd = 2,# Nokta 癟izgi kal覺nl覺覺
     alpha = 0.5)  # Nokta saydamlg覺覺覺 
legend("topright", 
       legend = c("Kalp Hastal覺覺 Yok", "Kalp Hastal覺覺 Var"), 
       col = c("blue", "red"), 
       pch = 19, 
       pt.cex = 1.1, # Nokta boyutu
       cex = 0.5,    # Metin boyutu
       title = "Kalp Hastal覺覺", 
       bg = "yellow",  # Arkaplan renk
       box.lwd = 1.5) # Kutu 癟izgi kal覺nl覺g覺覺


```

G繹r羹ld羹羹 羹zere, genel eilim, dinlenme kan bas覺nc覺n覺n y羹ksek olduu durumlarda kolesterol seviyelerinin artt覺覺 y繹n羹ndedir. Ayr覺ca, kalp hastal覺覺 olan bireylerin genellikle daha y羹ksek kolesterol seviyelerine sahip olduu g繹zlemlenmektedir.Ancak, bu ilikinin kesin olmad覺覺n覺 belirtmek gerekir, 癟羹nk羹 baz覺 d羹羹k dinlenme kan bas覺nc覺 deerlerine sahip bireylerin yine de y羹ksek kolesterol seviyelerine sahip olduu noktalar g繹r羹lebilmektedir.

Bunlar覺n yan覺nda bu grafikte Dinlenme Kan Bas覺nc覺 120- 140 - 160 mm/HG deerlerinde bir patern g繹r羹lmektedir. Bu paterinin 繹l癟羹mleri yuvarlayan doktorlar veya hemirelerden kaynakland覺覺 d羹羹n羹lmektedir.

Kolesterol deerleri 400'羹n 羹zerine 癟覺kt覺覺nda kalp hastal覺覺 olan bireylerin say覺s覺nda art覺 g繹zlemleniyor.

K覺rm覺z覺 ve mavi noktalar aras覺nda belirgin bir ayr覺m yok gibi g繹r羹n羹yor; bu, dinlenme kan bas覺nc覺 ve kolesterol deerlerinin tek ba覺na kalp hastal覺覺n覺 繹ng繹rmede yeterli olmad覺覺n覺 g繹sterebilir.

```{r warning = FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"
data <- read_excel("heart1.xlsx")
par(mfrow = c(2, 2), oma = c(0, 0, 2, 0), mar = c(4, 4, 2, 1), cex.lab = 0.8, cex.main = 1, cex.axis = 0.8)
df_filtered <- df_total[df_total$Kolestorel > 0,]
boxplot(df_filtered$Kolestorel ~ df_filtered$Kalp_Hastaligi, # Kolesterol ve Kalp Hastal覺覺
        main = "Kolesterol - Hastal覺k", 
        xlab = "Hastal覺k", 
        ylab = "Kolesterol", 
        col = c("turquoise", "coral"), 
        names = c("Hay覺r", "Evet"))


boxplot(data$`Dinlenme_Kan_Basinci mm/HG` ~ data$Kalp_Hastaligi, # Dinlenme Kan Bas覺nc覺 ve Kalp Hastal覺覺
        main = "Dinlenme Kan Bas覺nc覺 - Hastal覺k", 
        xlab = "Hastal覺k", 
        ylab = "Dinlenme Kan Bas覺nc覺 (mm/HG)", 
        col = c("turquoise", "coral"), 
        names = c("Hay覺r", "Evet"))


boxplot(data$Maks_Kalp_Atis ~ data$Kalp_Hastaligi, # Maksimum Kalp At覺覺 ve Kalp Hastal覺覺
        main = "Maksimum Kalp At覺覺-Hastal覺k", 
        xlab = "Hastal覺k", 
        ylab = "Maksimum Kalp At覺覺", 
        col = c("turquoise", "coral"), 
        names = c("Hay覺r", "Evet"))


boxplot(data$Yas ~ data$Kalp_Hastaligi, # Ya ve Kalp Hastal覺覺
        main = "Ya - Hastal覺k", 
        xlab = "HHastal覺k", 
        ylab = "Ya", 
        col = c("turquoise", "coral"), 
        names = c("Hay覺r", "Evet"))
title("Boxplots Niteliklerin Hastal覺a Etkisi", outer = TRUE, cex.main = 1)
```

Kalp hastal覺覺 olmayan bireylerde maksimum kalp at覺覺 genellikle daha y羹ksek (medyan yakla覺k 160)

Kalp hastal覺覺 olmayan bireylerin ya aral覺覺 genellikle daha d羹羹k ve daha dar bir aral覺kta younlam覺 (medyan yakla覺k 45).\
Kalp hastal覺覺 olan bireylerde ya daha geni bir aral覺kta da覺lm覺 ve daha y羹ksek (medyan yakla覺k 55).\
Bu da ya覺n, kalp hastal覺覺 i癟in 繹nemli bir risk fakt繹r羹 olduunu g繹stermektedir.

Veriler, kalp hastal覺覺 olan bireylerin genellikle daha y羹ksek kolesterol ve dinlenme kan bas覺nc覺na sahip olduunu, ancak maksimum kalp at覺lar覺n覺n ve yalar覺n覺n daha y羹ksek olduunu g繹stermektedir.

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"
df_total$Kalp_Hastaligi <- as.factor(df_total$Kalp_Hastaligi)
df_total$Agri_Tipi <- as.factor(df_total$Agri_Tipi)

ggplot(data = df_total, aes(x = Agri_Tipi, fill = Kalp_Hastaligi)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Agri Tipi ve Kalp Hastaligi Orani",
       x = "Agri Tipi",
       y = "Oran",
       fill = "Kalp Hastaligi") +
  theme_minimal()
```

Bu grafik, hangi ar覺 tiplerinin kalp hastal覺覺 ile daha 癟ok ilikilendirildiini g繹rselletirerek analiz etmeye yard覺mc覺 olur. rnein, TA (Asimptomatik) ar覺 tipi olan bireylerin aras覺nda kalp hastal覺覺na sahip olanlar覺n oran覺n覺n dier ar覺 tiplerine g繹re daha y羹ksek olduu g繹zlemlenmektedir.

## Trend Analizi

襤lgili veri setinde dikkatimizi 癟eken ve g繹zlem verileriyle ispatlamak istediimiz YA ve KALP HASTALII arasindaki trend oldu

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"

data <- read_excel("heart1.xlsx")


age_heart_disease <- data %>%
  group_by(Yas, Kalp_Hastaligi) %>%
  summarise(count = n()) %>%
  spread(Kalp_Hastaligi, count, fill = 0) %>%
  mutate(total = `0` + `1`,
         percent = `1` / total * 100)

ggplot(age_heart_disease, aes(x = Yas, y = percent)) +
  geom_area(fill = "lightblue", alpha = 0.5) +
  geom_line(color = "blue") +
  labs(title = "Yalara G繹re Kalp Hastal覺覺 Olma Y羹zdesi",
       x = "Ya",
       y = "Kalp Hastal覺覺 Olma Oran覺 (%)") +
  theme_minimal()
```

G繹r羹ld羹羹 羹zere, kalp hastal覺覺n覺n yala birlikte artt覺覺n覺 a癟覺k癟a g繹stermektedir. Gen癟 yalarda oran daha d羹羹kken, yaland覺k癟a kalp hastal覺覺na sahip olma oran覺 繹nemli 繹l癟羹de y羹kselmektedir.

## Model Uydurma

Elimizdeki veri seti i癟in bir tahmin modeli oluturmak istedik, Bu modelin incelediimiz veri seti kapsam覺nda veri setindeki 繹znitelikler kapsam覺nda Kalp Hastas覺 olup olmad覺覺n覺n sonucunu belirli oranlarda doru olarak tahmin etmesi i癟in 癟al覺malar yapt覺k.

襤lk olarak ilgili veri setindeki kategorik deikenleri vekt繹rlere 癟evirdik, daha sonra elimizdeki veri setinin %80 inceleme %20 test verisi olacak ekilde ay覺rd覺k. T羹m deikenleri vekt繹r yapt覺ktan sonra Lojistik Regresyon Modeli uygulayarak bir model 癟覺kard覺k ilgili modelin katsay覺lar覺 aa覺dad覺r.

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"
data <- read_excel("heart1.xlsx")
colnames(df_total) <- c("Yas", "Cinsiyet", "Agri_Tipi", "Dinlenme_Kan_Basinci", "Kolestorel", "Aclik_Kan_Sekeri", "Dinlenme_EKG", "Maks_Kalp_Atis", "Egzersiz_Angina", "Oldpeak", "ST_Egimi", "Kalp_Hastaligi")

df_total$Cinsiyet <- as.factor(df_total$Cinsiyet)
df_total$Agri_Tipi <- as.factor(df_total$Agri_Tipi)
df_total$Dinlenme_EKG <- as.factor(df_total$Dinlenme_EKG)
df_total$Egzersiz_Angina <- as.factor(df_total$Egzersiz_Angina)
df_total$ST_Egimi <- as.factor(df_total$ST_Egimi)
df_total$Kalp_Hastaligi <- as.factor(df_total$Kalp_Hastaligi)

set.seed(123)
trainIndex <- createDataPartition(df_total$Kalp_Hastaligi, p = .8, 
                                  list = FALSE, 
                                  times = 1)
data_train <- df_total[trainIndex, ]
data_test  <- df_total[-trainIndex, ]

model <- glm(Kalp_Hastaligi ~ ., data = data_train, family = binomial)
print(model)
```

Regresyon modeli deerleri ve katsay覺lar覺 yukar覺da yer almaktad覺r. Bu modeli kullanarak yap覺lan tahminleri test verisi ile test ettik ve sonu癟lar覺 i癟in karma覺kl覺 matrisinde aa覺daki gibi yazd覺rd覺k.

```{r  message=FALSE}
#| code-fold: true
#| code-summary: "R Talimatlar覺"
data <- read_excel("heart1.xlsx")
colnames(df_total) <- c("Yas", "Cinsiyet", "Agri_Tipi", "Dinlenme_Kan_Basinci", "Kolestorel", "Aclik_Kan_Sekeri", "Dinlenme_EKG", "Maks_Kalp_Atis", "Egzersiz_Angina", "Oldpeak", "ST_Egimi", "Kalp_Hastaligi")

df_total$Cinsiyet <- as.factor(df_total$Cinsiyet)
df_total$Agri_Tipi <- as.factor(df_total$Agri_Tipi)
df_total$Dinlenme_EKG <- as.factor(df_total$Dinlenme_EKG)
df_total$Egzersiz_Angina <- as.factor(df_total$Egzersiz_Angina)
df_total$ST_Egimi <- as.factor(df_total$ST_Egimi)
df_total$Kalp_Hastaligi <- as.factor(df_total$Kalp_Hastaligi)
set.seed(123)
trainIndex <- createDataPartition(df_total$Kalp_Hastaligi, p = .8, 
                                  list = FALSE, 
                                  times = 1)
data_train <- df_total[trainIndex, ]
data_test  <- df_total[-trainIndex, ]
model <- glm(Kalp_Hastaligi ~ ., data = data_train, family = binomial)

#########################################################################HATA ANAL襤Z襤###############################
predictions <- predict(model, data_test, type = "response")
predicted_classes <- ifelse(predictions > 0.5, 1, 0)

predicted_classes <- as.factor(predicted_classes)
levels(predicted_classes) <- levels(data_test$Kalp_Hastaligi)
confusionMatrix(predicted_classes, data_test$Kalp_Hastaligi)
cm <- confusionMatrix(predicted_classes, data_test$Kalp_Hastaligi)


```

-   **Doru Negatifler (TN)**: 73 (Modelin 0 olarak doru tahmin ettii ve ger癟ekte de 0 olan)

-   **Yanl覺 Negatifler (FN)**: 7 (Modelin 0 olarak yanl覺 tahmin ettii ve ger癟ekte 1 olan)

-   **Yanl覺 Pozitifler (FP)**: 9 (Modelin 1 olarak yanl覺 tahmin ettii ve ger癟ekte 0 olan)

-   **Doru Pozitifler (TP)**: 94 (Modelin 1 olarak doru tahmin ettii ve ger癟ekte de 1 olan)

## Sonu癟lar

Sonu癟 olarak veri setindeki deikenlerin birbirleriyle olan ilikilerine anlaml覺 grafikler 癟izdirerek bakt覺k, incelenen grafiklerden net sonu癟lar ya覺n, egzersiz anginan覺n, Agri tipinin ve ST eiminin kalp hastal覺覺 羹zerinde dier etkilerden daha a覺rl覺kl覺 olduunu g繹rd羹k. Bunun yan覺nda cinsiyet fark覺n覺nda hastal覺a etkisi 繹nemli bir soru ortaya 癟覺kard覺, veri setinde cinsiyetlerin say覺lar覺n覺n eitlenmesinden sonra tekrar analizler yap覺larak daha doru sonu癟lara ula覺labilir. Elde edilen Regresyon modeli %91 oran覺nda doru sonu癟lar ortaya 癟覺karmaktad覺r. Ama tabiki bu sonu癟 test verimizde denendii i癟in baka test verilerinde de denenerek test edilmelidir. Bunlar覺n yan覺nda karar aac覺 modeli ile bir tahmin methodu gelitirdik bu method ile istenilen verileri girmeniz durumunda kalp hastas覺 olup olmad覺覺n覺z konusunda bir tahmin cevab覺 alabilirsiniz.

# Sonu癟lar ve Ana 覺kar覺mlar
